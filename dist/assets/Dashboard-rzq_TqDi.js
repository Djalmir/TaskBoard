import{_ as J,z as ae,u as K,r as n,k as q,A as se,g as oe,l as G,C as te,o as e,c,d as r,w as _,t as O,i as d,B as W,b as T,a as w,I as H,q as j,D as Q,F as z,E as D,e as le,p as X,h as Y,G as ne,s as L,y as $,H as x,n as R}from"./index-kLhPIVat.js";import{U as re,P as Z,t as A,a as ie}from"./ProfileModal-E4Edr298.js";import{M as de}from"./date-B_kJkEij.js";const ue=y=>(X("data-v-38b08734"),y=y(),Y(),y),ce=ue(()=>d("hr",null,null,-1)),ve={id:"sharingList"},he={__name:"BoardModal",emits:["boardCreated","boardEdited"],setup(y,{expose:P,emit:F}){ae(a=>({"43db2825":t.value}));const U=K(),b=n(),v=n(),k=n(),h=q("Message").value,g=n(!1),I=n(""),i=n(""),u=n([]),M=n([]),B=n("");let S;se(B,()=>{clearTimeout(S),v.value.hide(),S=setTimeout(()=>{B.value&&oe.searchProfile({search:B.value}).then(a=>{M.value=a.data.reduce((m,l)=>(l._id!==U.state.userProfile._id&&!u.value.find(V=>V._id===l._id)&&m.push({leftComponent:"Image",rounded:!0,src:l.profilePictureUrl,size:2,alt:"User Avatar",label:l.name,action:()=>{u.value.push(l),v.value.hide(),B.value="",M.value=[]}}),m),[])}).then(()=>{var a;M.value.length&&((a=v.value)==null||a.show(document.querySelector("#searchInput"),"left"))})},500)});const t=n(0),p=F;G(()=>{window.addEventListener("resize",s)});function E(a){if(a){const{_id:m,name:l,sharedWith:V}=JSON.parse(JSON.stringify(a));I.value=m,i.value=l,u.value=V,g.value=!0}else g.value=!1;b.value.show(),setTimeout(()=>{s()},300)}function s(){const a=document.querySelector("#searchInput");a&&(t.value=a.getBoundingClientRect().width+"px")}function C(){u.value.splice(u.value.indexOf(k.value.user),1),k.value.close()}function o(){if(!i.value)return h.show({error:"Por favor, insira um nome para o TaskBoard",field:"name"});A.createBoard({name:i.value,sharedWith:u.value.map(a=>a._id)}).then(a=>{p("boardCreated",{_id:a.data._id,name:i.value,sharedWith:u.value}),N()})}function f(){if(!i.value)return h.show({error:"Por favor, insira um nome para o TaskBoard",field:"name"});A.updateBoard({boardId:I.value,name:i.value,sharedWith:u.value.map(a=>a._id)}).then(a=>{p("boardEdited",{_id:a.data._id,name:i.value,sharedWith:u.value}),N()})}function N(){var a;I.value="",i.value="",u.value=[],M.value=[],B.value="",(a=v.value)==null||a.hide(),b.value.close()}return te(()=>{window.removeEventListener("resize",s)}),P({show:E}),(a,m)=>(e(),c(z,null,[r(de,{ref_key:"modal",ref:b,onClose:N,onKeypress:m[3]||(m[3]=le(()=>g.value?f():o(),["enter"]))},{header:_(()=>[d("b",null,O(g.value?"Editar":"Novo")+" TaskBoard",1)]),footer:_(()=>[r(W,{class:"secondary",onClick:N},{default:_(()=>[T("Cancelar")]),_:1}),g.value?(e(),w(W,{key:0,type:"submit",onClick:f},{default:_(()=>[T("Atualizar")]),_:1})):(e(),w(W,{key:1,type:"submit",onClick:o},{default:_(()=>[T("Criar")]),_:1}))]),default:_(()=>[r(H,{class:"input",label:"Nome",modelValue:i.value,"onUpdate:modelValue":m[0]||(m[0]=l=>i.value=l),autocomplete:"off",onFocus:m[1]||(m[1]=l=>j(h).closeByField("name"))},null,8,["modelValue"]),ce,r(H,{id:"searchInput",type:"search",class:"input",label:"Compartilhado com",placeholder:"Nome ou email",modelValue:B.value,"onUpdate:modelValue":m[2]||(m[2]=l=>B.value=l),autocomplete:"off"},null,8,["modelValue"]),r(Q,{list:M.value,ref_key:"dropDown",ref:v,class:"searchResultList"},null,8,["list"]),d("div",ve,[(e(!0),c(z,null,D(u.value,l=>(e(),w(re,{key:l._id,user:l,class:"userBadge",onClick:V=>k.value.show(l)},null,8,["user","onClick"]))),128))])]),_:1},512),r(Z,{ref_key:"profileModal",ref:k},{default:_(()=>[r(W,{class:"danger",onClick:C},{default:_(()=>[T("Remover")]),_:1})]),_:1},512)],64))}},pe=J(he,[["__scopeId","data-v-38b08734"]]),ee=y=>(X("data-v-d13cc16f"),y=y(),Y(),y),me={key:0,class:"my-boards"},fe={class:"boards"},_e={style:{flex:"1"}},ke={key:0,class:"sharingList"},we=ee(()=>d("span",null,"Compartilhado com:",-1)),ye={class:"sharingListWrapper"},Be={key:1,class:"shared-boards"},Ce={class:"boards"},ge={class:"boardHeader"},Ie={style:{flex:"1"}},be={key:0,class:"sharingList"},Me=ee(()=>d("span",null,"Compartilhado com:",-1)),xe={class:"sharingListWrapper"},ze={__name:"Dashboard",setup(y){const P=K(),F=q("Dialog").value,U=q("Message").value,b=n(),v=n(),k=n(),h=n([]),g=n([]),I=n([]);G(()=>{A.listBoards().then(t=>{h.value=t.data.myBoards,I.value=t.data.sharedBoards,i()})});function i(){P.dispatch("setBoards",{myBoards:h.value,sharedWithMe:I.value})}function u(t,p){if(k.value.showing)return k.value.hide(),t!==k.value.target?setTimeout(()=>{u(t,p)},200):void 0;g.value=[{leftComponent:"Icon",class:"edit",size:1.15,label:"Editar",action:()=>b.value.show(p)},{leftComponent:"Icon",class:"trash",size:1.15,label:"Excluir",action:async()=>{await F.confirm(`Deseja mesmo excluir o TaskBoard <b style='font-size: 1.2em;'>${p.name}</b>?`)&&A.deleteBoard(p._id).then(()=>{S(p)})}}],setTimeout(()=>{k.value.toggleShowing(t,"right")},0)}function M(t){h.value.push(t),setTimeout(()=>{i()},0)}function B(t){h.value.splice(h.value.findIndex(p=>p._id===t._id),1,t),setTimeout(()=>{U.show({success:"Edições salvas com sucesso!"}),i()},0)}function S(t){h.value.splice(h.value.findIndex(p=>p._id===t._id),1),setTimeout(()=>{U.show({success:"TaskBoard excluido com sucesso!"}),i()},0)}return(t,p)=>{const E=ne("router-link");return e(),c(z,null,[r(ie,{id:"newBoardBt",action:()=>b.value.show()},{default:_(()=>[T("Novo TaskBoard")]),_:1},8,["action"]),d("section",null,[h.value.length?(e(),c("div",me,[d("h2",null,[r($,{class:"layout",size:2}),T(" - Meus TaskBoards ")]),d("div",fe,[(e(!0),c(z,null,D(h.value,s=>(e(),c("div",{key:s._id},[r(E,{to:{name:"Board",params:{boardId:s._id}},class:"board"},{default:_(()=>{var C;return[d("b",_e,O(s.name),1),(C=s.sharedWith)!=null&&C.length?(e(),c("div",ke,[we,d("div",ye,[(e(!0),c(z,null,D(s.sharedWith,o=>(e(),c("div",{key:`${s._id}-${o._id}`},[o.profilePictureUrl?(e(),w(R,{key:0,class:"user",src:o.profilePictureUrl,alt:"user avatar",rounded:"",size:2.5,onClick:x(f=>v.value.show(o),["prevent"])},null,8,["src","onClick"])):(e(),w($,{key:1,class:"user",size:2.5,rounded:"",onClick:x(f=>v.value.show(o),["prevent"])},null,8,["onClick"]))]))),128))])])):L("",!0)]}),_:2},1032,["to"]),r(W,{class:"optionsBt",onClick:x(C=>u(C.target,s),["prevent"])},{default:_(()=>[r($,{class:"more-vertical",size:1.5})]),_:2},1032,["onClick"])]))),128))])])):L("",!0),I.value.length?(e(),c("div",Be,[d("h2",null,[r($,{class:"send",size:2}),T(" - Compartilhados comigo ")]),d("div",Ce,[(e(!0),c(z,null,D(I.value,s=>(e(),w(E,{key:s._id,to:{name:"Board",params:{boardId:s._id}},class:"board"},{default:_(()=>{var C;return[d("div",ge,[d("b",Ie,O(s.name),1),s.owner.profilePictureUrl?(e(),w(R,{key:0,class:"user",src:s.owner.profilePictureUrl,alt:"user avatar",rounded:"",size:2.5,onClick:x(o=>v.value.show(s.owner),["prevent"])},null,8,["src","onClick"])):(e(),w($,{key:1,class:"user",size:2.5,rounded:"",onClick:x(o=>v.value.show(s.owner),["prevent"])},null,8,["onClick"]))]),(C=s.sharedWith)!=null&&C.filter(o=>{var f;return o._id!==((f=j(P).state.userProfile)==null?void 0:f._id)}).length?(e(),c("div",be,[Me,d("div",xe,[(e(!0),c(z,null,D(s.sharedWith.filter(o=>{var f;return o.id!==((f=j(P).state.userProfile)==null?void 0:f._id)}),o=>(e(),c("div",{key:`${s._id}-${o._id}`},[o.profilePictureUrl?(e(),w(R,{key:0,class:"user",src:o.profilePictureUrl,alt:"user avatar",rounded:"",size:2.5,onClick:x(f=>v.value.show(o),["prevent"])},null,8,["src","onClick"])):(e(),w($,{key:1,class:"user",size:2,onClick:x(f=>v.value.show(o),["prevent"])},null,8,["onClick"]))]))),128))])])):L("",!0)]}),_:2},1032,["to"]))),128))])])):L("",!0)]),r(pe,{ref_key:"boardModal",ref:b,onBoardCreated:M,onBoardEdited:B},null,512),r(Z,{ref_key:"profileModal",ref:v},null,512),r(Q,{ref_key:"dropDown",ref:k,list:g.value},null,8,["list"])],64)}}},We=J(ze,[["__scopeId","data-v-d13cc16f"]]);export{We as default};
