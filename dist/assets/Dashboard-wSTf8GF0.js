import{_ as G,r as s,k as A,o as a,a as $,w as p,b as t,B as T,d as B,I as O,e as J,z as E,p as Q,h as X,i as l,A as fe,u as te,C as he,D as _e,g as j,l as oe,E as ke,c as d,t as q,q as Z,s as S,G as se,F as V,H as W,J as ye,y as D,n as H}from"./index-DQIYcgEA.js";import{U as we,P as le,t as F,a as ge}from"./ProfileModal-BXrFj84b.js";import{M as ne}from"./date-CKDMa2YQ.js";const Ce=k=>(Q("data-v-7b053ab7"),k=k(),X(),k),Be=Ce(()=>l("b",{id:"title"},"Convidar colaborador",-1)),Ie={__name:"InviteModal",emits:["filledInvitation"],setup(k,{expose:P,emit:L}){const x=s(),M=A("Message").value,u=s(""),f=s(""),y=L;function U(z){f.value=z||"",x.value.show()}function I(){if(!f.value)return M.show({error:"O campo email é obrigatório",field:"email"});y("filledInvitation",u.value,f.value),w()}function w(){u.value="",f.value="",x.value.close()}return P({show:U}),(z,h)=>(a(),$(ne,{ref_key:"modal",ref:x,onClose:w},{header:p(()=>[Be]),footer:p(()=>[t(T,{class:"secondary",onClick:w},{default:p(()=>[B("Cancelar")]),_:1}),t(T,{type:"submit",onClick:I},{default:p(()=>[B("Enviar convite")]),_:1})]),default:p(()=>[t(O,{class:"input",label:"Nome",type:"text",modelValue:u.value,"onUpdate:modelValue":h[0]||(h[0]=c=>u.value=c),onKeypress:J(E(I,["stop"]),["enter"])},null,8,["modelValue","onKeypress"]),t(O,{class:"input",id:"email",label:"Email",type:"email",modelValue:f.value,"onUpdate:modelValue":h[1]||(h[1]=c=>f.value=c),onKeypress:J(E(I,["stop"]),["enter"])},null,8,["modelValue","onKeypress"])]),_:1},512))}},be=G(Ie,[["__scopeId","data-v-7b053ab7"]]),Y=k=>(Q("data-v-2ecef32f"),k=k(),X(),k),$e=Y(()=>l("hr",null,null,-1)),xe={key:0,id:"alreadyInBoard"},Me={key:1,id:"inviteMsg"},Ue=Y(()=>l("br",null,null,-1)),ze={id:"sharingList"},Ee={key:2,id:"invitedList"},Te=Y(()=>l("b",{style:{display:"block",margin:"33px 0 7px","font-size":".9rem","padding-left":"7px","white-space":"nowrap","font-weight":"bold"}},"Convidados",-1)),Ve={__name:"BoardModal",emits:["boardCreated","boardEdited"],setup(k,{expose:P,emit:L}){fe(e=>({"11eb8e68":r.value}));const x=te(),M=s(),u=s(),f=s(),y=s(),U=A("Message").value,I=A("Dialog").value,w=s(!1),z=s(""),h=s(""),c=s([]),v=s([]),n=s([]),g=s(!1),_=s(""),i=he(()=>x.state.userProfile.email==_.value||c.value.find(e=>e.email==_.value));let b;_e(_,()=>{g.value=!1,clearTimeout(b),u.value.hide(),b=setTimeout(()=>{!_.value||!de(_.value)||j.searchProfile({search:_.value}).then(e=>{n.value=e.data.reduce((m,o)=>(o._id!==x.state.userProfile._id&&!c.value.find(N=>N._id===o._id)&&m.push({leftComponent:"Image",rounded:!0,src:o.profilePictureUrl,size:2,alt:"User Avatar",label:o.name,action:()=>{c.value.push(o),u.value.hide(),_.value="",n.value=[]}}),m),[])}).then(()=>{var e;n.value.length?(e=u.value)==null||e.show(document.querySelector("#searchInput"),"left"):g.value=!0})},500)});const r=s(0),C=L;oe(()=>{window.addEventListener("resize",R)});function re(e){if(e){const{_id:m,name:o,sharedWith:N,invitedUsers:pe}=JSON.parse(JSON.stringify(e));z.value=m,h.value=o,c.value=N,v.value=pe,w.value=!0}else w.value=!1;v.value.map(m=>m.invited=!0),M.value.show(),setTimeout(()=>{R()},300)}function de(e){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())}function ue(){y.value.show(_.value)}function ce(e,m){v.value.push({name:e,email:m}),_.value="",setTimeout(()=>{U.show({success:`O quadro será compartilhado automaticamente assim que ${e||"o(a) convidado(a)"} criar uma conta.`})},200)}async function ve(e){await I.confirm("<b>Tem certeza que deseja remover este convidado?</b> <br/> Será preciso mandar um novo email para convidá-lo novamente.")&&v.value.splice(v.value.indexOf(e),1)}function R(){const e=document.querySelector("#searchInput");e&&(r.value=e.getBoundingClientRect().width+"px")}function me(){c.value.splice(c.value.indexOf(f.value.user),1),f.value.close()}function ee(){if(!h.value)return U.show({error:"Por favor, insira um nome para o TaskBoard",field:"name"});F.createBoard({name:h.value,sharedWith:c.value.map(e=>e._id),invitedUsers:v.value}).then(e=>{C("boardCreated",{_id:e.data._id,name:h.value,sharedWith:c.value,invitedUsers:v.value})}).then(()=>{v.value.length&&v.value.map(e=>{e.invited||j.sendInvitationEmail({email:e.email,name:e.name})})}).finally(()=>{K()})}function ae(){if(!h.value)return U.show({error:"Por favor, insira um nome para o TaskBoard",field:"name"});F.updateBoard({boardId:z.value,name:h.value,sharedWith:c.value.map(e=>e._id),invitedUsers:v.value}).then(e=>{C("boardEdited",{_id:e.data._id,name:h.value,sharedWith:c.value,invitedUsers:v.value})}).then(()=>{v.value.length&&v.value.map(e=>{e.invited||j.sendInvitationEmail({email:e.email,name:e.name})})}).finally(()=>{K()})}function K(){var e;z.value="",h.value="",_.value="",n.value=[],c.value=[],v.value=[],(e=u.value)==null||e.hide(),M.value.close()}return ke(()=>{window.removeEventListener("resize",R)}),P({show:re}),(e,m)=>(a(),d(V,null,[t(ne,{ref_key:"modal",ref:M,onClose:K,onKeypress:m[3]||(m[3]=J(()=>w.value?ae():ee(),["enter"]))},{header:p(()=>[l("b",null,q(w.value?"Editar":"Novo")+" TaskBoard",1)]),footer:p(()=>[t(T,{class:"secondary",onClick:K},{default:p(()=>[B("Cancelar")]),_:1}),w.value?(a(),$(T,{key:0,type:"submit",onClick:ae},{default:p(()=>[B("Atualizar")]),_:1})):(a(),$(T,{key:1,type:"submit",onClick:ee},{default:p(()=>[B("Criar")]),_:1}))]),default:p(()=>[t(O,{class:"input",label:"Nome",placeholder:"máx. 33 caracteres",modelValue:h.value,"onUpdate:modelValue":m[0]||(m[0]=o=>h.value=o),maxlength:"33",autocomplete:"off",onFocus:m[1]||(m[1]=o=>Z(U).closeByField("name"))},null,8,["modelValue"]),$e,t(O,{id:"searchInput",type:"search",class:"input",label:"Compartilhado com",placeholder:"Email do convidado",modelValue:_.value,"onUpdate:modelValue":m[2]||(m[2]=o=>_.value=o),autocomplete:"off"},null,8,["modelValue"]),i.value?(a(),d("span",xe,"Este usuário já está nesse TaskBoard.")):g.value?(a(),d("span",Me,[B("Este email não está cadastrado no TaskBoard. "),Ue,l("a",{href:"#",onClick:ue},"Clique aqui para enviar um convite"),B(".")])):S("",!0),t(se,{list:n.value,ref_key:"dropDown",ref:u,class:"searchResultList"},null,8,["list"]),l("div",ze,[(a(!0),d(V,null,W(c.value,o=>(a(),$(we,{key:o._id,user:o,class:"userBadge",onClick:N=>f.value.show(o)},null,8,["user","onClick"]))),128))]),v.value.length?(a(),d("div",Ee,[Te,(a(!0),d(V,null,W(v.value,o=>(a(),d("div",{class:"invited",key:o.email},[l("span",null,q(o.name?o.name+" - ":"")+" "+q(o.email),1),t(T,{class:"danger rmInvite",onClick:N=>ve(o)},{default:p(()=>[B("Remover")]),_:2},1032,["onClick"])]))),128))])):S("",!0)]),_:1},512),t(le,{ref_key:"profileModal",ref:f},{default:p(()=>[t(T,{class:"danger",onClick:me},{default:p(()=>[B("Remover")]),_:1})]),_:1},512),t(be,{ref_key:"inviteModal",ref:y,onFilledInvitation:ce},null,512)],64))}},Pe=G(Ve,[["__scopeId","data-v-2ecef32f"]]),ie=k=>(Q("data-v-ba5e9658"),k=k(),X(),k),De={key:0,class:"my-boards"},Se={class:"boards"},We={class:"boardHeader"},Le={style:{flex:"1"}},Ne={key:0,class:"sharingList"},qe=ie(()=>l("span",null,"Compartilhado com:",-1)),Ae={class:"sharingListWrapper"},Ke={key:1,class:"shared-boards"},Oe={class:"boards"},Fe={class:"boardHeader"},Re={style:{flex:"1"}},je={key:0,class:"sharingList"},He=ie(()=>l("span",null,"Compartilhado com:",-1)),Je={class:"sharingListWrapper"},Ze={__name:"Dashboard",setup(k){const P=te(),L=A("Dialog").value,x=A("Message").value,M=s(),u=s(),f=s(),y=s([]),U=s([]),I=s([]);oe(()=>{F.listBoards().then(n=>{y.value=n.data.myBoards,I.value=n.data.sharedBoards,w()})});function w(){P.dispatch("setBoards",{myBoards:y.value,sharedWithMe:I.value})}function z(n,g){if(f.value.showing)return f.value.hide(),n!==f.value.target?setTimeout(()=>{z(n,g)},200):void 0;U.value=[{leftComponent:"Icon",class:"edit",size:1.15,label:"Editar",action:()=>M.value.show(g)},{leftComponent:"Icon",class:"trash",size:1.15,label:"Excluir",action:async()=>{await L.confirm(`Deseja mesmo excluir o TaskBoard <b style='font-size: 1.2em;'>${g.name}</b>?`)&&F.deleteBoard(g._id).then(()=>{v(g)})}}],setTimeout(()=>{f.value.toggleShowing(n,"right")},0)}function h(n){y.value.push(n),setTimeout(()=>{w()},0)}function c(n){y.value.splice(y.value.findIndex(g=>g._id===n._id),1,n),setTimeout(()=>{x.show({success:"Edições salvas com sucesso!"}),w()},0)}function v(n){y.value.splice(y.value.findIndex(g=>g._id===n._id),1),setTimeout(()=>{x.show({success:"TaskBoard excluido com sucesso!"}),w()},0)}return(n,g)=>{const _=ye("router-link");return a(),d(V,null,[t(ge,{id:"newBoardBt",action:()=>M.value.show()},{default:p(()=>[B("Novo TaskBoard")]),_:1},8,["action"]),l("section",null,[y.value.length?(a(),d("div",De,[l("h2",null,[t(D,{class:"layout",size:2}),B(" - Meus TaskBoards ")]),l("div",Se,[(a(!0),d(V,null,W(y.value,i=>(a(),d("div",{key:i._id},[t(_,{to:{name:"Board",params:{boardId:i._id}},class:"board"},{default:p(()=>{var b;return[l("div",We,[l("b",Le,q(i.name),1)]),(b=i.sharedWith)!=null&&b.length?(a(),d("div",Ne,[qe,l("div",Ae,[(a(!0),d(V,null,W(i.sharedWith,r=>(a(),d("div",{key:`${i._id}-${r._id}`},[r.profilePictureUrl?(a(),$(H,{key:0,class:"user",src:r.profilePictureUrl,alt:"user avatar",rounded:"",size:2.25,onClick:E(C=>u.value.show(r),["prevent"])},null,8,["src","onClick"])):(a(),$(D,{key:1,class:"user",size:2.5,rounded:"",onClick:E(C=>u.value.show(r),["prevent"])},null,8,["onClick"]))]))),128))])])):S("",!0)]}),_:2},1032,["to"]),t(T,{class:"optionsBt",onClick:E(b=>z(b.target,i),["prevent"])},{default:p(()=>[t(D,{class:"more-vertical",size:1.5})]),_:2},1032,["onClick"])]))),128))])])):S("",!0),I.value.length?(a(),d("div",Ke,[l("h2",null,[t(D,{class:"send",size:2}),B(" - Compartilhados comigo ")]),l("div",Oe,[(a(!0),d(V,null,W(I.value,i=>(a(),d("div",{key:i._id},[t(_,{to:{name:"Board",params:{boardId:i._id}},class:"board"},{default:p(()=>{var b;return[l("div",Fe,[l("b",Re,q(i.name),1),i.owner.profilePictureUrl?(a(),$(H,{key:0,class:"user",src:i.owner.profilePictureUrl,alt:"user avatar",rounded:"",size:2.5,onClick:E(r=>u.value.show(i.owner),["prevent"])},null,8,["src","onClick"])):(a(),$(D,{key:1,class:"user",size:2.5,rounded:"",onClick:E(r=>u.value.show(i.owner),["prevent"])},null,8,["onClick"]))]),(b=i.sharedWith)!=null&&b.filter(r=>{var C;return r._id!==((C=Z(P).state.userProfile)==null?void 0:C._id)}).length?(a(),d("div",je,[He,l("div",Je,[(a(!0),d(V,null,W(i.sharedWith.filter(r=>{var C;return r.id!==((C=Z(P).state.userProfile)==null?void 0:C._id)}),r=>(a(),d("div",{key:`${i._id}-${r._id}`},[r.profilePictureUrl?(a(),$(H,{key:0,class:"user",src:r.profilePictureUrl,alt:"user avatar",rounded:"",size:2.25,onClick:E(C=>u.value.show(r),["prevent"])},null,8,["src","onClick"])):(a(),$(D,{key:1,class:"user",size:2,onClick:E(C=>u.value.show(r),["prevent"])},null,8,["onClick"]))]))),128))])])):S("",!0)]}),_:2},1032,["to"])]))),128))])])):S("",!0)]),t(Pe,{ref_key:"boardModal",ref:M,onBoardCreated:h,onBoardEdited:c},null,512),t(le,{ref_key:"profileModal",ref:u},null,512),t(se,{ref_key:"dropDown",ref:f,list:U.value},null,8,["list"])],64)}}},Ye=G(Ze,[["__scopeId","data-v-ba5e9658"]]);export{Ye as default};
