import{_ as ie,A as ye,K as j,o as c,c as M,m as De,t as ue,s as Y,j as y,r as t,C as le,n as be,v as Ce,x as ke,e as f,z as X,L as Se,M as he,w as D,f as ge,T as Ee,F as Z,G as ae,b as H,J as S,B as A,N as Le,l as me,q as r,d as ce,I as pe,O as Fe,k as $e,E as Be,p as Ve,i as ze,g as Me,D as xe,y as Je,P as _e,Q as qe}from"./index-dyas_CNS.js";import{t as Q,U as Oe,P as Pe,a as je}from"./ProfileModal-2s6GcfW8.js";import{M as We}from"./ProfilePictureModal-feXCkFTI.js";const Ye=["checked"],Ge={__name:"Checkbox",props:{modelValue:{type:Boolean,default:!1},rounded:{type:Boolean,default:!1},class:{type:String},pin:{type:Boolean,default:!1}},setup(a){ye(m=>({"76609c12":b.value}));const h=a,b=j(()=>h.rounded||h.pin?"50%":"0.15em");return(m,E)=>(c(),M("input",De({type:"checkbox",checked:a.modelValue,onChange:E[0]||(E[0]=I=>m.$emit("update:modelValue",I.target.checked)),class:`${h.class?h.class:""} ${h.pin?"pin":""}`},m.$attrs),null,16,Ye))}},Qe=ie(Ge,[["__scopeId","data-v-058ec0cb"]]),Ze={key:0},et=["value"],tt={__name:"Textarea",props:["modelValue","label"],setup(a){return(h,b)=>(c(),M("label",null,[a.label?(c(),M("span",Ze,ue(a.label),1)):Y("",!0),y("textarea",De({value:a.modelValue,onInput:b[0]||(b[0]=m=>h.$emit("update:modelValue",m.target.value))},h.$attrs),null,16,et)]))}},Ie=ie(tt,[["__scopeId","data-v-b546a1b9"]]),ot={class:"carouselUi"},nt={class:"carouselUi"},st={__name:"Carousel",props:{class:{type:String}},setup(a,{expose:h}){var F,ne;ye(p=>({e703ae3a:z.value}));const b=a,m=t(),E=t(),I=t(),$=t(),_=t(),L=t(),w=t([]),l=t([]),C=t(0),V=t(),B=t(),s=t(!1),z=t(`${((F=m.value)==null?void 0:F.parentElement.offsetWidth)||0}px`),O=t(`${((ne=m.value)==null?void 0:ne.parentElement.offsetWidth)*.75||0}px`);le(s,()=>{setTimeout(()=>{var p;N(C.value,"smooth"),(p=E.value)==null||p.focus()},250)}),be(()=>{P(),window.addEventListener("resize",K),K()});function P(){let p={childList:!0};V.value=new MutationObserver(()=>{K()}),V.value.observe(_.value,p),V.value.observe(L.value,p),p={root:document.documentElement},B.value=new IntersectionObserver(n=>{n.forEach(v=>{v.isIntersecting&&K()})}),B.value.observe(m.value,p)}function J(){if(w.value=_.value?Array.from(_.value.children):[],!w.value.length){s.value&&(s.value=!1);return}w.value.map(p=>{p.style=`
			width: ${O.value};
			height: calc(100% - 33px);
			aspect-ratio: 16/9;
		`}),setTimeout(()=>{N(C.value,"auto")},0),l.value=L.value?Array.from(L.value.children):[],l.value.map(p=>{p.style=`
			width: ${window.innerWidth}px;
			height: calc(100dvh - 33px);
			overflow: auto;
		`})}function N(p,n="smooth"){w.value.length&&(p<0?p=0:p>=w.value.length&&(p=w.value.length-1),setTimeout(()=>{if(m.value){C.value=p;let v=m.value.getBoundingClientRect(),R=_.value.getBoundingClientRect(),te=Array.from(_.value.children)[p].getBoundingClientRect();I.value.scrollTo({top:0,left:te.x-R.x-(v.width-te.width)/2,behavior:n}),setTimeout(()=>{if(L.value){let de=L.value.getBoundingClientRect(),se=Array.from(L.value.children)[p].getBoundingClientRect();$.value.scrollTo({top:0,left:se.x-de.x-(window.innerWidth-se.width)/2,behavior:n})}},0)}},0))}function ee(p){switch(p.key){case"ArrowLeft":N(--C.value);break;case"ArrowRight":N(++C.value);break}}function K(){var p,n;z.value=`${((p=m.value)==null?void 0:p.parentElement.offsetWidth)||0}px`,O.value=`${((n=m.value)==null?void 0:n.parentElement.offsetWidth)*.75||0}px`,J()}return h({fullScreen:s}),(p,n)=>(c(),M(Z,null,[y("div",{class:he(`carousel ${b.class||""}`),ref_key:"carousel",ref:m},[Ce(y("div",ot,[f(X,{class:"chevron-left",size:2,onClick:n[0]||(n[0]=v=>N(--C.value))}),f(X,{class:"chevron-right",size:2,onClick:n[1]||(n[1]=v=>N(++C.value))})],512),[[ke,w.value.length]]),Ce(y("div",{class:"carouselScroll",ref_key:"scroller",ref:I},[y("div",{class:"carouselSlidesWrapper",ref_key:"carouselSlidesWrapper",ref:_,onClick:n[2]||(n[2]=v=>s.value=!s.value)},[Se(p.$slots,"default",{},void 0,!0)],512)],512),[[ke,w.value.length]])],2),f(Ee,{name:"grow"},{default:D(()=>[Ce(y("div",{class:he(`fullScreenCarousel ${b.class||""}`),ref_key:"fullScreenCarousel",ref:E,tabindex:"0",onKeydown:[n[6]||(n[6]=ge(v=>{s.value&&(s.value=!1),v.stopPropagation(),v.preventDefault()},["escape"])),ee]},[y("div",nt,[f(X,{class:"chevron-left",size:2,onClick:n[3]||(n[3]=v=>N(--C.value))}),f(X,{class:"chevron-right",size:2,onClick:n[4]||(n[4]=v=>N(++C.value))})]),y("div",{class:"fullScreenCarouselScroll",ref_key:"fullScreenscroller",ref:$},[y("div",{class:"fullScreenCarouselSlidesWrapper",ref_key:"fullScreenCarouselSlidesWrapper",ref:L,onClick:n[5]||(n[5]=v=>s.value=!s.value)},[Se(p.$slots,"default",{},void 0,!0)],512)],512)],34),[[ke,s.value]])]),_:3})],64))}},Ne=ie(st,[["__scopeId","data-v-70e14860"]]),at={class:"tabs"},lt={key:1},it={__name:"Tabs",setup(a,{expose:h}){const b=t(),m=t(),E=t(),I=t(!1),$=t([]),_=t(null);le(_,(C,V)=>{let B=m.value.querySelector(`[tab-id=${V}]`);B&&(B.classList.remove("active"),B.style.display="none");let s=m.value.querySelector(`[tab-id=${C}]`);s.classList.add("active"),s.style.display="block"}),be(()=>{L(),w()});function L(){let C={childList:!0};E.value=new MutationObserver(()=>{w()}),E.value.observe(m.value,C)}function w(){let C=Array.from(m.value.querySelectorAll("[tab-id]"));if(!C.length)return console.error("No tabs found. Each tab must have a [tab-id] attribute.");$.value=C.map(V=>(V.style.display="none",{id:V.getAttribute("tab-id"),icon:V.getAttribute("tab-icon"),title:V.getAttribute("tab-title")})),_.value=$.value[0].id}function l(C){_.value==C?I.value=!I.value:(_.value=C,I.value=!0)}return h({showingContent:I}),(C,V)=>(c(),M("div",at,[y("header",{ref_key:"header",ref:b},[y("nav",null,[(c(!0),M(Z,null,ae($.value,B=>(c(),H(A,{key:B.id,class:he(`${_.value==B.id&&I.value?"active":"flat"} selector`),onClick:S(s=>l(B.id),["stop"]),onMousedown:V[0]||(V[0]=S(()=>{},["stop"]))},{default:D(()=>[B.icon?(c(),H(X,{key:0,class:he(B.icon),size:.95},null,8,["class"])):Y("",!0),B.title?(c(),M("span",lt,ue(B.title),1)):Y("",!0)]),_:2},1032,["class","onClick"]))),128))])],512),f(Ee,{name:"growDown"},{default:D(()=>[Ce(y("section",{ref_key:"section",ref:m},[Se(C.$slots,"default",{},void 0,!0)],512),[[ke,I.value]])]),_:3})]))}},dt=ie(it,[["__scopeId","data-v-3b4f40d5"]]),rt={__name:"ListModal",emits:["listCreated","listRenamed"],setup(a,{expose:h,emit:b}){const m=t(),E=Le(),I=me("Message").value,$=E.params.boardId,_=t(""),L=t(""),w=t(!1),l=b;function C(z){if(z){const{_id:O,name:P}=JSON.parse(JSON.stringify(z));_.value=O,L.value=P,w.value=!0}else w.value=!1;m.value.show()}function V(){Q.createList({boardId:$,name:L.value}).then(z=>{l("listCreated",z.data),s()})}function B(){Q.updateList({listId:_.value,name:L.value}).then(z=>{l("listRenamed",z.data),s()})}function s(){_.value="",L.value="",m.value.close()}return h({show:C}),(z,O)=>(c(),H(r(We),{ref_key:"modal",ref:m,onClose:s,onKeypress:O[2]||(O[2]=ge(()=>w.value?B():V(),["enter"]))},{header:D(()=>[y("b",null,ue(w.value?"Renomear":"Nova")+" Lista",1)]),footer:D(()=>[f(r(A),{class:"secondary",onClick:s},{default:D(()=>[ce("Cancelar")]),_:1}),w.value?(c(),H(r(A),{key:0,type:"submit",onClick:B},{default:D(()=>[ce("Atualizar")]),_:1})):(c(),H(r(A),{key:1,type:"submit",onClick:V},{default:D(()=>[ce("Criar")]),_:1}))]),default:D(()=>[f(r(pe),{class:"input",label:"Nome",modelValue:L.value,"onUpdate:modelValue":O[0]||(O[0]=P=>L.value=P),autocomplete:"getoff",onFocus:O[1]||(O[1]=P=>r(I).closeByField("name"))},null,8,["modelValue"])]),_:1},512))}},ut=ie(rt,[["__scopeId","data-v-14a65d44"]]),ct={key:0,class:"todoActions"},vt={__name:"Todo",props:{todo:Object},emits:["removeTodo","newTodo","editTodo"],setup(a,{emit:h}){const b=a,m=t(),E=h;le(()=>b.todo.done,()=>{E("editTodo",b.todo)});function I(){b.todo.editing=!0,setTimeout(()=>{m.value.$el.focus()},0)}function $(){var w;if(!((w=b.todo.todo)!=null&&w.trim()))return!1;b.todo.editing=!1,E("editTodo",b.todo)}function _(){E("removeTodo",b.todo)}function L(){$(),E("newTodo")}return(w,l)=>(c(),M("li",{class:"todo",onClick:l[2]||(l[2]=()=>{a.todo.editing||(a.todo.done=!a.todo.done)}),onMouseenter:l[3]||(l[3]=C=>a.todo.mouseIn=!0),onMouseleave:l[4]||(l[4]=C=>a.todo.mouseIn=!1)},[f(r(Qe),{modelValue:a.todo.done,"onUpdate:modelValue":l[0]||(l[0]=C=>a.todo.done=C)},null,8,["modelValue"]),f(r(pe),{ref_key:"input",ref:m,disabled:!a.todo.editing,onBlur:$,onKeypress:ge(L,["enter"]),class:"todoInput",modelValue:a.todo.todo,"onUpdate:modelValue":l[1]||(l[1]=C=>a.todo.todo=C),placeholder:"Descreva a tarefa",style:Fe(`${a.todo.editing?"":"box-shadow: none; background: transparent; cursor: pointer; pointer-events: none;"} width: 100%;`)},null,8,["disabled","onKeypress","modelValue","style"]),a.todo.mouseIn&&a.todo.canEdit?(c(),M("div",ct,[a.todo.editing?Y("",!0):(c(),H(r(A),{key:0,class:"flat actionButton",onClick:S(I,["stop"])},{default:D(()=>[f(r(X),{class:"edit",size:1.25})]),_:1},8,["onClick"])),f(r(A),{class:"flat actionButton",onClick:S(_,["stop"]),style:{color:"var(--danger-light)"}},{default:D(()=>[f(r(X),{class:"trash-2",size:1.25})]),_:1},8,["onClick"])])):Y("",!0)],32))}},Re=ie(vt,[["__scopeId","data-v-ce0159e4"]]),Ue=a=>(Ve("data-v-6c1b984f"),a=a(),ze(),a),ft={key:0},mt={class:"todosList"},gt=Ue(()=>y("span",null,"Adicionar Todo",-1)),pt={key:0},ht=["onMouseenter","onMouseleave"],wt=["src"],yt=Ue(()=>y("span",null,"Adicionar Imagens",-1)),bt={id:"assignedList"},Ct={__name:"CardModal",props:{members:{type:Array}},emits:["cardCreated","cardEdited"],setup(a,{expose:h,emit:b}){var q;ye(d=>({f4b3937a:de.value,"195b12f4":se.value,a1a203da:oe.value,"90fa1acc":G.value,"1e4f0eda":te.value,"6ac5c0e1":v.value})),$e();const m=t(),E=Le(),I=me("Message").value,$=t(null),_=t(),L=t(),w=t(),l=j(()=>E.params.boardId),C=a,V=t(null),B=t(null),s=t(""),z=t(""),O=t([]),P=t([]),J=t({}),N=t([]),ee=t([]),K=t([]),F=t(!1),ne=b,p=t("");let n;le(p,()=>{clearTimeout(n),L.value.hide(),n=setTimeout(()=>{p.value&&(N.value=C.members.filter(d=>d.name.toLowerCase().includes(p.value.toLowerCase())||d.email.toLowerCase().includes(p.value.toLowerCase())).reduce((d,g)=>(K.value.find(T=>T._id===g._id)||d.push({leftComponent:"Image",rounded:!0,src:g.profilePictureUrl,size:2,alt:"User Avatar",label:g.name,action:()=>{K.value.push(g),L.value.hide(),p.value="",N.value=[]}}),d),[]),setTimeout(()=>{var d;N.value.length&&(u(),(d=L.value)==null||d.show(m.value.$el.querySelector("#searchInput"),"left"))},0))},500)});const v=t(0),R=j(()=>{var d;return(d=_.value)==null?void 0:d.fullScreen}),te=j(()=>{var d;return(d=_.value)!=null&&d.fullScreen?"contain":"cover"}),de=j(()=>{var d;return(d=_.value)!=null&&d.fullScreen?"7px 77px":"0"}),se=t(window.innerWidth<window.innerHeight?"grid":"auto"),oe=t((q=_.value)!=null&&q.fullScreen&&window.innerWidth>window.innerHeight?"100%":"unset"),G=t(`calc(50% - ${oe.value} / 2)`);le(R,()=>{u()});function we(d,g){if(V.value=d,g){const{_id:T,title:re,description:Ae,todos:Ke}=JSON.parse(JSON.stringify(g));B.value=T,s.value=re,z.value=Ae||"",O.value=Ke.map(Te=>({...Te,canEdit:!0}));let Xe=g.images.map((Te,He)=>({...Te,src:g.imageUrls[He].src}));P.value=Xe,K.value=g.assignedTo?JSON.parse(JSON.stringify(g.assignedTo)):[],ee.value=g.comments?JSON.parse(JSON.stringify(g.comments)):[],F.value=!0}else F.value=!1;m.value.show(),window.addEventListener("resize",u),setTimeout(()=>{if(P.value.length){let T=P.value;P.value=[],setTimeout(()=>{P.value=T,u()},0)}},300)}function ve(){let d=m.value.$el.querySelector(".todosList .todo:last-child .todoInput input");(!O.value.length||d&&d.value.trim())&&O.value.push({todo:"",done:!1,editing:!0,canEdit:!0}),setTimeout(()=>{d=m.value.$el.querySelector(".todosList .todo:last-child .todoInput input"),d&&(d.editing=!0,setTimeout(()=>{d.focus()},0))},0)}function fe(d){O.value.splice(O.value.indexOf(d),1)}function i(d){P.value=[...P.value,...Array.from(d.target.files).reduce((g,T)=>{if(T.type.startsWith("image"))return[...g,{src:URL.createObjectURL(T),file:T}]},[])],d.target.value=""}function u(){const d=m.value.$el.querySelector("#searchInput");d&&(v.value=d.getBoundingClientRect().width+"px"),_.value&&(se.value=window.innerWidth<window.innerHeight?"grid":"auto",oe.value=_.value.fullScreen&&window.innerWidth>window.innerHeight?"calc(100% - 33px)":"unset",G.value=`calc(50% - ${oe.value} / 2)`)}function x(){K.value.splice(K.value.indexOf(w.value.user),1),w.value.close()}function o(){let d=new FormData;return d.append("board",l.value),d.append("list",V.value._id||V.value),d.append("title",s.value),d.append("description",z.value),d.append("todos",JSON.stringify(O.value.map(g=>({todo:g.todo,done:g.done})))),P.value.map(g=>{g._id?d.append("keepImages",JSON.stringify(g)):(d.append("images",g.file),d.append("legends",J.value[g.file.name]))}),d.append("comments",JSON.stringify(ee.value)),d.append("assignedTo",JSON.stringify(K.value)),d}function e(d){d.shiftKey||(F.value?U():W(),d.preventDefault())}function W(){if(!s.value)return I.show({error:"Por favor, insira um título para o Card"});let d=o();Q.createCard(d).then(g=>{ne("cardCreated",g.data),k(!0)})}function U(){if(!s.value)return I.show({error:"Por favor, insira um título para o Card"});let d=o();d.append("cardId",B.value),Q.updateCard(d).then(g=>{ne("cardEdited",g.data),k(!0)})}function k(d){(d||F.value)&&(s.value="",z.value="",O.value=[],P.value=[],J.value={},K.value=[],ee.value=[]),m.value.close(),window.removeEventListener("resize",u)}return h({show:we}),(d,g)=>(c(),M(Z,null,[f(r(We),{ref_key:"modal",ref:m,id:"cardModal",onClose:k},{header:D(()=>[y("b",null,ue(F.value?"Editar":"Novo")+" Card",1)]),footer:D(()=>[f(r(A),{class:"secondary",onClick:g[9]||(g[9]=T=>k(!0))},{default:D(()=>[ce("Cancelar")]),_:1}),F.value?(c(),H(r(A),{key:0,onClick:U},{default:D(()=>[ce("Atualizar")]),_:1})):(c(),H(r(A),{key:1,onClick:W},{default:D(()=>[ce("Criar")]),_:1}))]),default:D(()=>[f(r(pe),{modelValue:s.value,"onUpdate:modelValue":g[0]||(g[0]=T=>s.value=T),label:"Título",class:"input",onFocus:g[1]||(g[1]=T=>r(I).closeByField("title")),onKeydown:ge(S(e,["stop"]),["enter"])},null,8,["modelValue","onKeydown"]),f(r(Ie),{modelValue:z.value,"onUpdate:modelValue":g[2]||(g[2]=T=>z.value=T),label:"Descrição",class:"input",style:{resize:"vertical"},onKeydown:ge(S(e,["stop"]),["enter"])},null,8,["modelValue","onKeydown"]),y("fieldset",null,[O.value.length?(c(),M("legend",ft,"Todos")):Y("",!0),y("ul",mt,[(c(!0),M(Z,null,ae(O.value,T=>(c(),H(Re,{key:T,todo:T,onRemoveTodo:fe,onNewTodo:ve},null,8,["todo"]))),128))]),f(r(A),{onClick:ve,class:"flat addItemButton"},{default:D(()=>[f(r(X),{class:"check-square"}),gt]),_:1})]),y("fieldset",null,[P.value.length?(c(),M("legend",pt,"Imagens")):Y("",!0),f(r(Ne),{class:"carousel",ref_key:"carousel",ref:_},{default:D(()=>[(c(!0),M(Z,null,ae(P.value,T=>(c(),M("div",{key:T,class:"slideWrapper"},[y("div",{class:"slide",onMouseenter:re=>T.mouseIn=!0,onMouseleave:re=>T.mouseIn=!1},[y("img",{src:T.src,alt:"task image",class:"image"},null,8,wt),T.file?(c(),H(r(pe),{key:0,placeholder:"Legenda",modelValue:J.value[T.file.name],"onUpdate:modelValue":re=>J.value[T.file.name]=re,class:"legendInput",onClick:g[3]||(g[3]=S(()=>{},["stop"])),onKeydown:g[4]||(g[4]=S(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue"])):(c(),H(r(pe),{key:1,placeholder:"Legenda",modelValue:T.legend,"onUpdate:modelValue":re=>T.legend=re,class:"legendInput",onClick:g[5]||(g[5]=S(()=>{},["stop"])),onKeydown:g[6]||(g[6]=S(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue"])),T.mouseIn?(c(),H(r(A),{key:2,class:"rmImgButton",onClick:S(re=>P.value.splice(P.value.indexOf(T),1),["stop"])},{default:D(()=>[f(r(X),{class:"trash-2",size:1.15})]),_:2},1032,["onClick"])):Y("",!0)],40,ht)]))),128))]),_:1},512),y("input",{type:"file",ref_key:"filePicker",ref:$,id:"filePicker",accept:"image/*",multiple:"",hidden:"",onChange:i},null,544),f(r(A),{onClick:g[7]||(g[7]=T=>$.value.click()),class:"flat addItemButton"},{default:D(()=>[f(r(X),{class:"image"}),yt]),_:1})]),f(r(pe),{id:"searchInput",type:"search",class:"input",label:"Atribuído a",placeholder:"Nome ou email",modelValue:p.value,"onUpdate:modelValue":g[8]||(g[8]=T=>p.value=T),autocomplete:"off"},null,8,["modelValue"]),f(r(Be),{list:N.value,ref_key:"dropDown",ref:L,class:"searchResultList"},null,8,["list"]),y("div",bt,[(c(!0),M(Z,null,ae(K.value,T=>(c(),H(Oe,{key:T._id,user:T,class:"userBadge",onClick:re=>w.value.show(T)},null,8,["user","onClick"]))),128))])]),_:1},512),f(Pe,{ref_key:"profileModal",ref:w},{default:D(()=>[f(r(A),{class:"danger",onClick:x},{default:D(()=>[ce("Remover")]),_:1})]),_:1},512)],64))}},kt=ie(Ct,[["__scopeId","data-v-6c1b984f"]]),_t=["id","onMousedown","onMouseenter","onTouchmove"],$t={key:0},Tt={key:1},St={class:"assignedToListWrapper"},It={key:0,"tab-icon":"check-square","tab-id":"todosTab"},Lt={class:"todosList"},xt={key:1,"tab-icon":"image","tab-id":"imagesTab",class:"carouselTab"},Mt=["onMouseenter","onMouseleave"],Dt=["src"],Et={class:"legend"},Bt={"tab-icon":"message-square","tab-id":"commentsTab",class:"commentsTab"},Vt={class:"commentsList"},zt=["onMouseenter","onMouseleave"],Ot={key:0,class:"commentEditor"},Pt={key:1},Wt={key:2,class:"commentActions"},Nt={class:"newComment"},Rt={__name:"Card",props:{lists:Object,card:Object},emits:["showCardDropdown"],setup(a,{emit:h}){var x;ye(o=>({"22a7ff0e":ne.value,93464882:p.value,e3303db0:n.value,d28854a2:v.value,"0b093c5e":F.value}));const b=$e(),m=j(()=>b.state.board.draggingCard),E=t(),I=t(),$=t(),_=me("Dialog").value,L=me("Message").value,w=me("profileModal").value,l=a,C=h,V=j(()=>{var o,e;return((o=b.state.board.draggingCard)==null?void 0:o._id)==((e=l.card)==null?void 0:e._id)}),B=j(()=>b.state.board.draggingShadow),s=t(null),z=t(null),O=t(null);let P,J,N=!1;le(V,()=>{if(V.value){window.addEventListener("mouseup",u);let o=m.value.e;P=(o.clientX||o.touches[0].clientX)-E.value.getBoundingClientRect().left,J=(o.clientY||o.touches[0].clientY)-E.value.getBoundingClientRect().top;let e=E.value.cloneNode(!0);e.style=E.value.style,e.style.height=E.value.offsetHeight+"px",e.style.width=E.value.offsetWidth+"px",e.style.position="absolute",e.style.pointerEvents="none",e.style.zIndex="100",document.body.appendChild(e),b.dispatch("board/setDraggingShadow",e),document.body.style.userSelect="none",document.body.style.cursor="grabbing",window.addEventListener("mousemove",i),window.addEventListener("touchmove",i)}else B.value&&(window.removeEventListener("mouseup",u),B.value.remove(),b.dispatch("board/setDraggingShadow",null)),document.body.style.userSelect="auto",document.body.style.cursor="default",window.removeEventListener("mousemove",i),window.removeEventListener("touchmove",i)});let ee;le(()=>l.card.mouseIn,()=>{clearTimeout(ee),ee=setTimeout(()=>{l.card.mouseIn=!1},3e3)});const K=j(()=>{var o;return(o=$.value)==null?void 0:o.fullScreen}),F=j(()=>{var o;return(o=$.value)!=null&&o.fullScreen?"contain":"cover"}),ne=j(()=>{var o;return(o=$.value)!=null&&o.fullScreen?"7px 77px":"0"}),p=t(window.innerWidth<window.innerHeight?"grid":"auto"),n=t((x=$.value)!=null&&x.fullScreen&&window.innerWidth>window.innerHeight?"calc(100% - 33px)":"unset"),v=t(`calc(50% - ${n.value} / 2)`);le(K,()=>{te()}),be(()=>{window.addEventListener("resize",te)});function R(o,e){C("showCardDropdown",o,e.list,e)}function te(){$.value&&(p.value=window.innerWidth<window.innerHeight?"grid":"auto",n.value=$.value.fullScreen&&window.innerWidth>window.innerHeight?"calc(100% - 33px)":"unset",v.value=`calc(50% - ${n.value} / 2)`)}function de(){Q.updateCard({cardId:l.card._id,todos:l.card.todos}).then(o=>{l.card.todos=o.data.todos})}async function se(o){await _.confirm("Tem certeza que deseja remover esta tarefa?")&&(l.card.todos.splice(l.card.todos.indexOf(o),1),de())}function oe(o){l.card.newComment&&(l.card.comments||(l.card.comments=[]),l.card.comments.push({user:b.state.userProfile._id,text:l.card.newComment}),Q.updateCard({cardId:l.card._id,comments:l.card.comments}).then(e=>{l.card.newComment="",l.card.comments=e.data.comments}))}function G(o){if(!o.text)return L.show({error:"O comentário não pode estar vazio"});Q.updateCard({cardId:l.card._id,comments:l.card.comments}).then(e=>{o.editing=!1,l.card.comments=e.data.comments})}async function we(o){await _.confirm("Deseja mesmo excluir este comentário?")&&(l.card.comments.splice(l.card.comments.indexOf(o),1),Q.updateCard({cardId:l.card._id,comments:l.card.comments}).then(e=>{l.card.comments=e.data.comments}))}function ve(o){clearTimeout(O.value),N=!0,O.value=setTimeout(()=>{N&&(s.value=l.lists.find(e=>e.cards.find(W=>W._id==l.card._id)),z.value=s.value.cards.findIndex(e=>e._id==l.card._id),b.dispatch("board/setDraggingCard",{...l.card,e:o}))},150)}function fe(){m.value&&m.value._id!=l.card._id&&Me("changeCardsPositions",l.card._id)}function i(o){if(B.value)try{B.value.style.left=`${(o.clientX||o.touches[o.touches.length-1].clientX)-P}px`,B.value.style.top=`${(o.clientY||o.touches[o.touches.length-1].clientY)-J}px`}catch{}}function u(){let o=l.lists.find(e=>e.cards.find(W=>W._id==l.card._id));s.value._id!=o._id||z.value!=o.cards.findIndex(e=>e._id==l.card._id)?(l.card.list=o._id,Me("moveCard")):b.dispatch("board/setDraggingCard",null)}return xe(()=>{window.removeEventListener("resize",te)}),(o,e)=>(c(),M("div",{id:a.card._id,class:he(`card ${V.value?"dragging":""}`),ref_key:"cardEl",ref:E,onMousemove:e[11]||(e[11]=W=>a.card.mouseIn=!0),onMousedown:S(ve,["stop","prevent"]),onTouchstart:e[12]||(e[12]=S(W=>{a.card.mouseIn=!0,ve(W)},["stop","prevent"])),onMouseleave:e[13]||(e[13]=W=>a.card.mouseIn=!1),onMouseenter:S(fe,["stop","prevent"]),onTouchmove:S(fe,["stop","prevent"]),onMouseup:e[14]||(e[14]=W=>_e(N)?N.value=!1:N=!1),onTouchend:e[15]||(e[15]=W=>_e(N)?N.value=!1:N=!1)},[y("header",null,[y("b",null,ue(a.card.title),1),!m.value&&a.card.mouseIn?(c(),H(r(A),{key:0,class:"optionsBt",onMousedown:e[0]||(e[0]=S(()=>{},["stop"])),onTouchstart:e[1]||(e[1]=S(()=>{},["stop"])),onClick:e[2]||(e[2]=S(W=>R(W.target,a.card),["stop"]))},{default:D(()=>[f(r(X),{class:"more-vertical",size:1.2})]),_:1})):Y("",!0)]),a.card.description?(c(),M("hr",$t)):Y("",!0),a.card.description||a.card.assignedTo?(c(),M("section",Tt,[ce(ue(a.card.description)+" ",1),y("div",St,[(c(!0),M(Z,null,ae(a.card.assignedTo,W=>(c(),M("div",{key:`${a.card._id}-${W._id}`},[W.profilePictureUrl?(c(),H(r(Je),{key:0,class:"user",src:W.profilePictureUrl,alt:"user avatar",rounded:"",size:1.5,onClick:S(U=>r(w).show(W),["stop","prevent"]),onMousedown:e[3]||(e[3]=S(()=>{},["stop"])),onTouchstart:e[4]||(e[4]=S(()=>{},["stop"]))},null,8,["src","onClick"])):(c(),H(r(X),{key:1,class:"user",size:1.5,rounded:"",onClick:S(U=>r(w).show(W),["stop","prevent"]),onMousedown:e[5]||(e[5]=S(()=>{},["stop"])),onTouchstart:e[6]||(e[6]=S(()=>{},["stop"]))},null,8,["onClick"]))]))),128))])])):Y("",!0),y("footer",null,[f(r(dt),{ref_key:"cardTabs",ref:I,onClick:e[8]||(e[8]=S(()=>{},["stop"])),onMousedown:e[9]||(e[9]=S(()=>{},["stop"])),onTouchstart:e[10]||(e[10]=S(()=>{},["stop"]))},{default:D(()=>{var W,U;return[(W=a.card.todos)!=null&&W.length?(c(),M("div",It,[y("ul",Lt,[(c(!0),M(Z,null,ae(a.card.todos,k=>(c(),H(Re,{key:k,todo:k,onRemoveTodo:q=>se(k),onEditTodo:de},null,8,["todo","onRemoveTodo"]))),128))])])):Y("",!0),(U=a.card.images)!=null&&U.length?(c(),M("div",xt,[f(r(Ne),{class:"carousel",ref_key:"carousel",ref:$},{default:D(()=>[(c(!0),M(Z,null,ae(a.card.imageUrls,k=>(c(),M("div",{key:k,class:"slideWrapper"},[y("div",{class:"slide",onMouseenter:q=>k.mouseIn=!0,onMouseleave:q=>k.mouseIn=!1},[y("img",{src:k.src,alt:"task image",class:"image"},null,8,Dt),y("span",Et,ue(k.legend),1)],40,Mt)]))),128))]),_:1},512)])):Y("",!0),y("div",Bt,[y("ul",Vt,[(c(!0),M(Z,null,ae(a.card.comments,k=>(c(),M("li",{key:k,onMouseenter:q=>k.mouseIn=!0,onMouseleave:q=>k.mouseIn=!1},[f(Oe,{user:k.user,style:{"font-weight":"bold"}},null,8,["user"]),k.editing?(c(),M("div",Ot,[f(r(Ie),{placeholder:"Editar comentario",modelValue:k.text,"onUpdate:modelValue":q=>k.text=q,class:"commentInput",onKeypress:ge(S(q=>G(k),["stop"]),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeypress"]),y("div",null,[f(r(A),{type:"submit",class:"commentButton",onClick:q=>G(k)},{default:D(()=>[f(r(X),{class:"edit",size:1})]),_:2},1032,["onClick"]),f(r(A),{class:"secondary commentButton",onClick:q=>k.editing=!1},{default:D(()=>[f(r(X),{class:"x",size:1})]),_:2},1032,["onClick"])])])):(c(),M("p",Pt,ue(k.text),1)),k.mouseIn&&k.user._id===r(b).state.userProfile._id&&!k.editing?(c(),M("div",Wt,[f(r(A),{class:"flat actionBt",onClick:q=>we(k)},{default:D(()=>[f(r(X),{class:"trash-2",size:1.15})]),_:2},1032,["onClick"]),f(r(A),{class:"flat actionBt",onClick:q=>k.editing=!0},{default:D(()=>[f(r(X),{class:"edit",size:1.15})]),_:2},1032,["onClick"])])):Y("",!0)],40,zt))),128))]),y("div",Nt,[f(r(Ie),{placeholder:"Comentar",modelValue:a.card.newComment,"onUpdate:modelValue":e[7]||(e[7]=k=>a.card.newComment=k),class:"commentInput",onKeypress:ge(S(oe,["stop"]),["enter"])},null,8,["modelValue","onKeypress"]),f(r(A),{type:"submit",class:"flat commentButton",onClick:oe},{default:D(()=>[f(r(X),{class:"send",size:1})]),_:1})])])]}),_:1},512)])],42,_t))}},Ut=ie(Rt,[["__scopeId","data-v-e81e9e29"]]),At=a=>(Ve("data-v-e0f69ac2"),a=a(),ze(),a),Kt=["id","onMousedown","onTouchstart"],Xt=At(()=>y("span",null,"Novo Card",-1)),Ht={__name:"List",props:{lists:Object,list:Object},emits:["showListDropdown","showCardDropdown","showCardModal","changeListsPositions","updateListsPositions","moveCardToList"],setup(a,{emit:h}){ye(n=>({"81674ce6":O.value}));const b=$e(),m=j(()=>b.state.board.draggingList),E=j(()=>b.state.board.draggingCard),I=t(),$=a,_=h,L=t(!1),w=t(null),l=t(null),C=t(null);let V,B,s=!1;le(L,()=>{var n;if(b.dispatch("board/setDraggingList",(n=L.value)==null?void 0:n._id),L.value){window.addEventListener("mouseup",F),window.addEventListener("touchend",F);let v=L.value.e,R=I.value.getBoundingClientRect();V=(v.clientX||v.touches[0].clientX)-R.left,B=(v.clientY||v.touches[0].clientY)-R.top,w.value=I.value.cloneNode(!0),w.value.style=I.value.style,w.value.style.height=I.value.offsetHeight+"px",w.value.style.position="absolute",w.value.style.pointerEvents="none",w.value.style.zIndex="100",document.body.appendChild(w.value),document.body.style.userSelect="none",document.body.style.cursor="grabbing"}else window.removeEventListener("mouseup",F),window.removeEventListener("touchend",F),w.value&&w.value.remove(),document.body.style.userSelect="auto",document.body.style.cursor="default"});const z=t(),O=t(z.value?z.value.offsetHeight+123+"px":0),P=t();be(()=>{J(),O.value=z.value?z.value.offsetHeight+123+"px":0,window.addEventListener("mousemove",p),window.addEventListener("touchmove",p)});function J(){let n={childList:!0,subtree:!0,attributes:!0};P.value=new MutationObserver(()=>{O.value=z.value?z.value.offsetHeight+123+"px":0}),P.value.observe(I.value,n)}function N(n,v){_("showListDropdown",n,v)}function ee(n,v,R){_("showCardDropdown",n,v,R)}function K(n){clearTimeout(C.value),s=!0,C.value=setTimeout(()=>{s&&(n.button==0||n.touches)&&(l.value=$.lists.findIndex(v=>v._id===$.list._id),L.value={_id:$.list._id,e:n})},150)}function F(){l.value!=$.lists.findIndex(n=>n._id===$.list._id)&&_("updateListsPositions"),setTimeout(()=>{L.value=!1},0)}function ne(){m.value&&m.value!=$.list._id&&_("changeListsPositions",$.list._id),E.value&&!$.list.cards.find(n=>n._id==E.value._id)&&_("moveCardToList",{from:$.lists.find(n=>n.cards.find(v=>v._id==E.value._id))._id,to:$.list._id})}function p(n){var v;if(m.value||E.value)if(m.value==I.value.id)try{w.value.style.left=`${(n.clientX||n.touches[n.touches.length-1].clientX)-V}px`,w.value.style.top=`${(n.clientY||n.touches[n.touches.length-1].clientY)-B}px`}catch{}else((v=n.touches)!=null&&v.length?document.elementsFromPoint(n.touches[n.touches.length-1].clientX,n.touches[n.touches.length-1].clientY):document.elementsFromPoint(n.clientX,n.clientY)).find(te=>te.id==I.value.id)&&ne()}return xe(()=>{var n;(n=P.value)==null||n.disconnect(),window.removeEventListener("mousemove",p),window.removeEventListener("touchmove",p)}),(n,v)=>(c(),M("div",{id:a.list._id,class:he(`list ${L.value?"dragging":""}`),ref_key:"listEl",ref:I,onMousedown:S(K,["stop","prevent"]),onTouchstart:S(K,["stop","prevent"]),onMouseup:v[6]||(v[6]=R=>_e(s)?s.value=!1:s=!1),onTouchend:v[7]||(v[7]=R=>_e(s)?s.value=!1:s=!1)},[y("header",null,[y("b",null,ue(a.list.name),1),f(r(A),{class:"optionsBt",onMousedown:v[0]||(v[0]=S(()=>{},["stop"])),onTouchstart:v[1]||(v[1]=S(()=>{},["stop"])),onClick:v[2]||(v[2]=S(R=>N(R.target,a.list),["stop"]))},{default:D(()=>[f(r(X),{class:"more-vertical",size:1.5})]),_:1})]),y("section",null,[y("div",{class:"cardsWrapper",ref_key:"cardsWrapper",ref:z},[(c(!0),M(Z,null,ae(a.list.cards,R=>(c(),H(Ut,{key:R._id,lists:a.lists,card:R,onShowCardDropdown:ee},null,8,["lists","card"]))),128))],512)]),y("footer",null,[f(r(A),{class:"addCardBt",onMousedown:v[3]||(v[3]=S(()=>{},["stop"])),onTouchstart:v[4]||(v[4]=S(()=>{},["stop"])),onClick:v[5]||(v[5]=S(R=>n.$emit("showCardModal"),["stop"]))},{default:D(()=>[f(r(X),{class:"plus",size:1.7}),Xt]),_:1})])],42,Kt))}},Ft=ie(Ht,[["__scopeId","data-v-e0f69ac2"]]),Jt={__name:"Board",setup(a){const h=$e(),b=Le(),m=t(b.params.boardId),E=t();qe("profileModal",E);const I=t(),$=t(),_=t(),L=me("Message").value,w=me("Dialog").value,l=t(),C=t(""),V=t({}),B=t([]),s=t([]),z=t([]),O=j(()=>h.state.board.dragScrolling);le(()=>b.params.boardId,()=>{m.value=b.params.boardId,C.value="",V.value={},B.value=[],s.value=[],P()}),be(()=>{P(),document.addEventListener("moveCard",fe),document.addEventListener("changeCardsPositions",ve)});function P(){Q.getBoardDetails(m.value).then(i=>{C.value=i.data.board.name,h.dispatch("setTitle",i.data.board.name),V.value=i.data.board.owner,B.value=i.data.board.sharedWith,s.value=i.data.lists})}function J(i,u,x){if(I.value.showing)return I.value.hide(),i!==I.value.target?setTimeout(()=>{J(i,u,x)},200):void 0;z.value=[{leftComponent:"Icon",class:"edit",size:1.15,label:x?"Editar":"Renomear",action:()=>x?se(u,x):$.value.show(u)},{leftComponent:"Icon",class:"trash",size:1.15,label:"Excluir",action:async()=>{await w.confirm(`Deseja mesmo excluir ${x?"o card":"a lista"} <b style='font-size: 1.2em;'>${x?x.title:u.name}</b>?`)&&(x?Q.deleteCard(x._id).then(()=>{n(x)}):Q.deleteList(u._id).then(()=>{K(u)}))}}],setTimeout(()=>{I.value.toggleShowing(i,"right")},0)}function N(i){s.value.push(i)}function ee(i){s.value.splice(s.value.findIndex(u=>u._id===i._id),1,i),setTimeout(()=>{L.show({success:"Lista renomeada com sucesso!"})},0)}function K(i){s.value.splice(s.value.findIndex(u=>u._id===i._id),1),setTimeout(()=>{L.show({success:"Lista excluida com sucesso!"})},0)}function F(i){let u=h.state.board.draggingList,x=s.value.findIndex(e=>e._id===u),o=s.value.findIndex(e=>e._id===i);u=s.value.find(e=>e._id==u),x<o?(s.value.splice(o+1,0,u),s.value.splice(x,1)):(s.value.splice(x,1),s.value.splice(o,0,u))}function ne(){Q.updateBoard({boardId:m.value,listsOrder:s.value.reduce((i,u)=>(i.push(u._id),i),[])})}function p(i){s.value.find(u=>u._id===i.list).cards.push(i)}function n(i){s.value.find(u=>u._id===i.list).cards.splice(s.value.find(u=>u._id===i.list).cards.findIndex(u=>u._id===i._id),1)}function v(i){s.value.find(u=>u._id===i.list).cards.splice(s.value.find(u=>u._id===i.list).cards.findIndex(u=>u._id===i._id),1,i)}function R(i){!h.state.board.draggingList&&i.clientX&&h.dispatch("board/setDragScrolling",{startX:i.clientX})}function te(i){if(O.value&&!h.state.board.draggingList){h.dispatch("board/setDragScrolling",{...h.state.board.dragScrolling,x:i.clientX});let u=h.state.board.dragScrolling.x-h.state.board.dragScrolling.startX;u<0&&(u*=-1),u>10&&(l.value.scrollLeft-=h.state.board.dragScrolling.x-h.state.board.dragScrolling.startX,h.dispatch("board/setDragScrolling",{...h.state.board.dragScrolling,startX:h.state.board.dragScrolling.x}))}}function de(){h.dispatch("board/setDragScrolling",null)}function se(i,u){_.value.show(i,u)}let oe,G;function we({from:i,to:u}){let x=s.value.find(o=>o._id==i).cards.find(o=>o._id==h.state.board.draggingCard._id);oe=s.value.find(o=>o._id==i),oe.cards.splice(oe.cards.findIndex(o=>o._id==x._id),1),G=s.value.find(o=>o._id==u),G.cards||(G.cards=[]),G.cards.unshift(x)}function ve(i){let u=i.detail,x=h.state.board.draggingCard,o=s.value.find(U=>U.cards.find(k=>k._id==u));if(!o.cards.find(U=>U._id==x._id))return;oe=o,G=o;let e=o.cards.findIndex(U=>U._id===x._id),W=o.cards.findIndex(U=>U._id===u);e<W?(o.cards.splice(W+1,0,x),o.cards.splice(e,1)):(o.cards.splice(e,1),o.cards.splice(W,0,x)),setTimeout(()=>{s.value.filter(U=>U._id!=o._id&&U.cards.find(k=>k._id==x._id)).map(U=>{U.cards.splice(U.cards.findIndex(k=>k._id==x._id),1)})},0)}function fe(){let i=h.state.board.draggingCard;i&&(Q.moveCard({board:m.value,fromList:i.list,toList:G._id,card:i._id,index:G.cards.findIndex(u=>u._id===i._id)}),h.dispatch("board/setDraggingCard",null))}return xe(()=>{h.dispatch("setTitle","TaskBoard"),document.removeEventListener("moveCard",fe),document.removeEventListener("changeCardsPositions",ve)}),(i,u)=>(c(),M(Z,null,[y("section",{ref_key:"section",ref:l,onMousedown:R,onMousemove:te,onMouseup:de,onMouseleave:de},[(c(!0),M(Z,null,ae(s.value,x=>(c(),H(Ft,{class:"boardList",id:x._id,key:x._id,lists:s.value,list:x,onShowListDropdown:J,onChangeListsPositions:F,onUpdateListsPositions:ne,onShowCardModal:o=>se(x,null),onShowCardDropdown:J,onMoveCardToList:we},null,8,["id","lists","list","onShowCardModal"]))),128))],544),f(r(je),{id:"newListBt",onClick:u[0]||(u[0]=x=>$.value.show())},{default:D(()=>[ce("Nova Lista")]),_:1}),f(r(Be),{ref_key:"dropDown",ref:I,list:z.value},null,8,["list"]),f(ut,{ref_key:"listModal",ref:$,onListCreated:N,onListRenamed:ee},null,512),f(kt,{ref_key:"cardModal",ref:_,members:[V.value,...B.value],onCardCreated:p,onCardEdited:v},null,8,["members"]),f(Pe,{ref_key:"profileModal",ref:E},null,512)],64))}},Gt=ie(Jt,[["__scopeId","data-v-26e06c59"]]);export{Gt as default};
